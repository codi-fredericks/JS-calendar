class Calendar{constructor(e={}){let t={"Default view":"month","Default mobile view":"week","Span events":!0,"Mobile width":900,"Auto color":!0,"Show offset":!1,"24 hour time":!1,"prefix with time":!0};return this.config={...t,...e},this.currentDate=new Date,this.view=this.config["Default view"],this.mobile_width=this.config["Mobile width"],this.container=document.createElement("div"),this.container.classList.add("calendar-container"),this.Vilgando=!0,this.events=new Map,this.metadata=new Map,this.dateIndex=new Map,this.timestampIndex=new Map,this.evnt_color="",this.init(),this}init(){this.container.innerHTML=`
    <div class="calendar">
        <div class="calendar_toolbar">
            <div style="display:flex;">
                <button id="prev">&lt;</button>
                
                <button id="calendar-title-button" style="background-color: transparent;color: black;display: flex; flex-direction: column;">
                    <span id="calendar-title" class="calendar-title"></span>
                    <input type="date" id="calendar-date-picker" class="calendar-date-picker" style="width: 0px; height: 0px; padding: 0px; margin: 0px;">
                </button>

                <button id="next">&gt;</button>
            </div>
            <div>
                <button data-view="month">Month</button>
                <button data-view="week">Week</button>
                <button data-view="day">Day</button>
                <button data-view="agenda">Agenda</button>
            </div>
        </div>
        <div class="calendar_bar_hr" id="calendar-week-head">
            <h2>Monday</h2>
            <h2>Tuesday</h2>
            <h2>Wednesday</h2>
            <h2>Thursday</h2>
            <h2>Friday</h2>
            <h2>Saturday</h2>
            <h2>Sunday</h2>
        </div>
        <div class="calendar_body" id="calendar-body"></div>
    </div>
    `,this.Vilgando&&console.log(`
%c\u004d\u0061\u0064\u0065\u0020\u0077\u0069\u0074\u0068\u0020\u2764\uFE0F\u0020\u0062\u0079\u0020\u0043\u006f\u0064\u0069\u0020\u0046\u0072\u0065\u0064\u0065\u0072\u0069\u0063\u006b\u0073
\u0068\u0074\u0074\u0070\u0073\u003a\u002f\u002f\u0064\u0065\u0076\u002d\u0064\u0061\u0076\u0065\u002e\u0063\u006f\u006d`,"color:#0dd8d8; background:#0k1021; font-size:1.5rem; padding:0.15rem 0.25rem; margin: 1rem auto; font-family: Rockwell; border: 2px solid #0dd8d8; border-radius: 4px;font-weight: bold; text-shadow: 1px 1px 1px #00af87boof;"),this.calendarBody=this.container.querySelector("#calendar-body"),this.calendarTitle=this.container.querySelector("#calendar-title"),this.calendarWeekHead=this.container.querySelector("#calendar-week-head"),this.datePicker=this.container.querySelector("#calendar-date-picker"),this.container.querySelector("#prev").addEventListener("click",()=>this.changeDate(-1)),this.container.querySelector("#next").addEventListener("click",()=>this.changeDate(1)),this.container.querySelectorAll("[data-view]").forEach(e=>e.addEventListener("click",e=>this.setView(e.target.dataset.view))),this.container.querySelector("#calendar-title-button").addEventListener("click",()=>{this.datePicker.showPicker()}),this.datePicker.addEventListener("change",e=>{this.currentDate=new Date(e.target.value),this.render()}),setTimeout(()=>{this.container.offsetWidth<this.mobile_width&&(this.view=this.config["Default mobile view"])},0),this.render()}async textToHexColor(e){if(window.crypto&&window.crypto.subtle)try{let t=new TextEncoder,a=t.encode(e),n=await crypto.subtle.digest("SHA-256",a),$=Array.from(new Uint8Array(n)),i=$.map(e=>e.toString(16).padStart(2,"0")).join("");return"#"+i.substring(0,6)}catch(r){return}}getTextColor(e){if(!e)return;let t=parseInt(e.slice(1,3),16),a=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return Math.log(1+(.2126*t+.7152*a+.0722*n))<Math.log(129)?"white":"black"}async add_event(e,t,a=!0){return new Promise(async(n,$)=>{try{let{id:i,title:r,start:d,end:l,tags:s,all_day:o,color:u,text_color:c}=e;if(!i)return $(Error("Event must have an ID!"));!u&&(s&&s.length>0?s[0].color?u=s[0].color:s[0].name?this.config["Auto color"]&&(u=await this.textToHexColor(s[0].name)):this.config["Auto color"]&&(u=await this.textToHexColor(r)):this.config["Auto color"]&&(u=await this.textToHexColor(r))),c||(c=this.getTextColor(u));let h=new Date(1e3*d),g=new Date(1e3*l);h=d instanceof Date?d:new Date(1e3*d),g=l instanceof Date?l:new Date(1e3*l);let p=h.getTime()/1e3,v=g.getTime()/1e3;if(this.config["prefix with time"]){let m=h.getHours(),f=h.getMinutes();r=this.config["24 hour time"]?`${h.getHours()}:${f<10?"0"+f:f} ${r}`:`${m%12||12}:${f<10?"0"+f:f} ${m<12?"AM":"PM"} ${r}`}this.events.set(i,{id:i,title:r,start_timestamp:p,end_timestamp:v,tags:s,color:u,text_color:c}),t&&this.metadata.set(i,t),!1===this.config["Span events"]?this.indexEventByDate(i,h,g,!0):this.indexEventByDate(i,h,g,o),a&&this.render()}catch(y){$(y)}n()})}roundDownToHour(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),0,0,0)}indexEventByDate(e,t,a,n){for(let $=new Date(t);$<=a;$.setUTCDate($.getUTCDate()+1)){if(!1===n&&$.getFullYear()===a.getFullYear()&&$.getMonth()===a.getMonth()&&$.getDate()===a.getDate()&&0===a.getHours()&&0===a.getMinutes()&&0===a.getSeconds())continue;let i=$.toLocaleDateString("en-US");if(this.dateIndex.has(i)||this.dateIndex.set(i,{events:new Set,time:new Map}),this.dateIndex.get(i).events.add(e),!n){let r=this.dateIndex.get(i);for(let d=0;d<24;d++){let l=new Date($.getFullYear(),$.getMonth(),$.getDate(),d,0,0);if(l<a&&l>=this.roundDownToHour(t)){let s=`${d.toString().padStart(2,"0")}00`;r.time.has(s)||r.time.set(s,new Set),r.time.get(s).add(e)}}}}}get_events_by_date(e){let t=e.toLocaleDateString("en-US");if(!this.dateIndex.has(t))return[];let a=this.dateIndex.get(t);return[...a.events].map(e=>this.events.get(e)).sort((e,t)=>e.start_timestamp-t.start_timestamp)}get_events_by_time(e,t){let a=e.toLocaleDateString("en-US");if(!this.dateIndex.has(a))return[];let n=this.dateIndex.get(a);return n.time.has(t)?[...n.time.get(t)].map(e=>this.events.get(e)).sort((e,t)=>e.start_timestamp-t.start_timestamp):[]}setView(e){this.view=e,this.render()}render(){this.calendarBody.innerHTML="",setTimeout(()=>{this.container.offsetWidth<this.mobile_width?(this.container.setAttribute("mobile",!0),this.calendarWeekHead.innerHTML=`
                <h2>Mon</h2>
                <h2>Tue</h2>
                <h2>Wed</h2>
                <h2>Thu</h2>
                <h2>Fri</h2>
                <h2>Sat</h2>
                <h2>Sun</h2>`):(this.container.setAttribute("mobile",!1),this.calendarWeekHead.innerHTML=`
                <h2>Monday</h2>
                <h2>Tuesday</h2>
                <h2>Wednesday</h2>
                <h2>Thursday</h2>
                <h2>Friday</h2>
                <h2>Saturday</h2>
                <h2>Sunday</h2>`)},0),setTimeout(()=>{"month"===this.view?(this.renderMonthView(),this.calendarWeekHead.style.display=""):"week"===this.view?(this.renderWeekView(),this.calendarWeekHead.style.display=""):"day"===this.view?(this.renderDayView(),this.calendarWeekHead.style.display="none"):"agenda"===this.view?(this.renderAgendaView(),this.calendarWeekHead.style.display="none"):alert(`Calendar View Invalid (${this.view})`)},0)}renderMonthView(){this.calendarTitle.textContent=this.currentDate.toLocaleString("default",{month:"long",year:"numeric"});let e=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),1),t=1-(0===e.getDay()?6:e.getDay()-1);for(let a=0;a<6;a++){this.currentDate.getFullYear(),this.currentDate.getMonth();let n=document.createElement("div");n.classList.add("calendar_week");let $=document.createElement("div");$.classList.add("calendar_week_events"),n.appendChild($);let i=[],r=1;for(let d=t;d<t+7;d++){let l=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),d),s=this.get_events_by_date(l);s.forEach(e=>{let t=i.find(t=>t.id===e.id);t?t.end+=1:i.push({id:e.id,start:r,end:r+1,text:e.title,color:e.color,text_color:e.text_color})}),r++}i.sort((e,t)=>e.start-t.start);let o={"c-1":1,"c-2":1,"c-3":1,"c-4":1,"c-5":1,"c-6":1,"c-7":1,"c-8":1},u=1;i.forEach(e=>{let t=1;for(let a=e.start;a<e.end;a++)o[a]||(o[a]=0),t=Math.max(t,o[a]);t++;for(let n=e.start;n<e.end;n++)o[n]=t;let i=document.createElement("button");i.classList.add("event"),i.innerText=e.text,i.style.gridArea=`${t} / ${e.start} / ${t+1} / ${e.end}`,i.style.backgroundColor=e.color,i.style.color=e.text_color,i.addEventListener("click",()=>this.open_event(e.id)),$.appendChild(i),u++}),$.parentNode.style.height=`calc(80px + (${this.container.offsetWidth<this.mobile_width?43:24}px*${Math.max(...Object.values(o))}))`;for(let c=0;c<7;c++){let h=document.createElement("div");h.classList.add("calendar_day");let g=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),t),p=document.createElement("span");p.classList.add("calendar_stamp"),p.innerText=`${g.getDate()} ${this.config["Show offset"]?`(GMT ${-(new Date().getTimezoneOffset()/60)})`:""}`,h.appendChild(p),g.getMonth()!==this.currentDate.getMonth()&&h.classList.add("other-month"),n.appendChild(h),t++}this.calendarBody.appendChild(n)}}renderWeekView(){let e=this.getStartOfWeek(this.currentDate),t=e.getDate(),a=new Date(e);a.setDate(e.getDate()+6);let n={month:"long",day:"numeric"};this.calendarTitle.textContent=`${e.toLocaleDateString("en-US",n)} - ${a.toLocaleDateString("en-US",n)} ${a.getFullYear()}`;let $=document.createElement("div");$.classList.add("calendar_week");let i=document.createElement("div");i.classList.add("calendar_week_events"),$.appendChild(i);let r=[],d=1;for(let l=t;l<t+7;l++){let s=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),l),o=this.get_events_by_date(s);o.forEach(e=>{let t=r.find(t=>t.id===e.id);t?t.end+=1:r.push({id:e.id,start:d,end:d+1,text:e.title,color:e.color,text_color:e.text_color})}),d++}r.sort((e,t)=>e.start-t.start);let u={"c-1":1,"c-2":1,"c-3":1,"c-4":1,"c-5":1,"c-6":1,"c-7":1,"c-8":1},c=1;r.forEach(e=>{let t=1;for(let a=e.start;a<e.end;a++)u[a]||(u[a]=0),t=Math.max(t,u[a]);t++;for(let n=e.start;n<e.end;n++)u[n]=t;let $=document.createElement("button");$.classList.add("event"),$.innerText=e.text,$.style.gridArea=`${t} / ${e.start} / ${t+1} / ${e.end}`,$.style.backgroundColor=e.color,$.style.color=e.text_color,$.addEventListener("click",()=>this.open_event(e.id)),i.appendChild($),c++}),i.parentNode.style.height=`calc(80px + (${this.container.offsetWidth<this.mobile_width?43:24}px*${Math.max(...Object.values(u))}))`;for(let h=0;h<7;h++){let g=new Date(e);g.setDate(e.getDate()+h);let p=document.createElement("div");p.classList.add("calendar_day");let v=document.createElement("span");v.classList.add("calendar_stamp"),v.innerText=g.getDate(),p.appendChild(v),$.appendChild(p)}this.calendarBody.appendChild($);let m=document.createElement("div");m.classList.add("calendar_week_time_container");let f=!0;for(let y=t;y<t+7;y++){let w=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),y),_=document.createElement("div");_.classList.add("calendar_week_time_container_sub");let b=document.createElement("h2");b.innerText=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][w.getDay()],_.appendChild(b);let x=document.createElement("div");x.classList.add("calendar_week_time_container_sub_sub");let D=document.createElement("div");D.classList.add("calendar_week_time_container_events");let k=[],E=1;for(let L=0;L<24;L++){let C=this.get_events_by_time(w,`${L.toString().padStart(2,"0")}00`);C.forEach(e=>{let t=k.find(t=>t.id===e.id);t?t.end+=1:k.push({id:e.id,start:E,end:E+1,text:e.title,color:e.color,text_color:e.text_color})}),E++}k.sort((e,t)=>e.start-t.start);let S={};if(k.forEach(e=>{let t=1;for(let a=e.start;a<e.end;a++)S[a]||(S[a]=0),t=Math.max(t,S[a]);t++;for(let n=e.start;n<e.end;n++)S[n]=t;let $=document.createElement("button");$.classList.add("calendar_week_event"),$.innerText=e.text,$.style.gridArea=`${e.start} / ${t-1} / ${e.end} / ${t}`,$.style.backgroundColor=e.color,$.style.color=e.text_color,$.onclick=function(){this.open_event(e.id)},$.addEventListener("click",()=>this.open_event(e.id)),D.appendChild($)}),f){let T=document.createElement("div");T.classList.add("calendar_week_time_container_stamps");for(let M=0;M<24;M++){let H=document.createElement("div");H.classList.add("calendar_week_time_stamp"),H.innerText=`${this.config["24 hour time"]?`${M}:00`:`${M%12==0?12:M%12}:00 ${M<12?"AM":"PM"}`}`,T.appendChild(H)}x.appendChild(T),f=!1}x.appendChild(D),_.appendChild(x),m.appendChild(_),this.calendarBody.appendChild(m)}}renderDayView(){this.calendarTitle.textContent=this.currentDate.toDateString();let e=document.createElement("div");e.classList.add("calendar_day");let t=document.createElement("span");t.classList.add("calendar_stamp"),t.innerText=this.currentDate.toDateString(),e.appendChild(t);let a=this.get_events_by_date(this.currentDate),n=document.createElement("div");n.classList.add("calendar_day_events");let $=2;console.log(a),a.forEach(e=>{console.log(e);let t=document.createElement("button");t.classList.add("calendar_week_event"),t.innerText=e.title,t.style.gridArea=`${$} / 1 / ${$} / 1`,t.style.backgroundColor=e.color,t.style.color=e.text_color,t.onclick=function(){this.open_event(e.id)},t.addEventListener("click",()=>this.open_event(e.id)),n.appendChild(t),$++}),e.appendChild(n),this.calendarBody.appendChild(e),n.parentNode.style.height=`calc(80px + (${this.container.offsetWidth<this.mobile_width?43:24}px*${$}))`;let i=document.createElement("div");i.classList.add("calendar_week_time_container");let r=!0,d=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),this.currentDate.getDate()),l=document.createElement("div");l.classList.add("calendar_week_time_container_sub");let s=document.createElement("div");s.classList.add("calendar_week_time_container_sub_sub");let o=document.createElement("div");o.classList.add("calendar_week_time_container_events");let u=[],c=1;for(let h=0;h<24;h++){let g=this.get_events_by_time(d,`${h.toString().padStart(2,"0")}00`);g.forEach(e=>{let t=u.find(t=>t.id===e.id);t?t.end+=1:u.push({id:e.id,start:c,end:c+1,text:e.title,color:e.color,text_color:e.text_color})}),c++}console.log(u),u.sort((e,t)=>e.start-t.start);let p={};if(u.forEach(e=>{let t=1;for(let a=e.start;a<e.end;a++)p[a]||(p[a]=0),t=Math.max(t,p[a]);t++;for(let n=e.start;n<e.end;n++)p[n]=t;let $=document.createElement("button");$.classList.add("calendar_week_event"),$.innerText=e.text,$.style.gridArea=`${e.start} / ${t-1} / ${e.end} / ${t}`,$.style.backgroundColor=e.color,$.style.color=e.text_color,$.onclick=function(){this.open_event(e.id)},$.addEventListener("click",()=>this.open_event(e.id)),o.appendChild($)}),r){let v=document.createElement("div");v.classList.add("calendar_day_time_container_stamps");for(let m=0;m<24;m++){let f=document.createElement("div");f.classList.add("calendar_day_time_stamp"),f.innerText=`${this.config["24 hour time"]?`${m}:00`:`${m%12==0?12:m%12}:00 ${m<12?"AM":"PM"}`}`,v.appendChild(f)}s.appendChild(v),r=!1}s.appendChild(o),l.appendChild(s),i.appendChild(l),this.calendarBody.appendChild(i)}renderAgendaView(){this.calendarTitle.textContent=this.currentDate.toLocaleString("default",{month:"long",year:"numeric"});let e=this.currentDate.getFullYear(),t=this.currentDate.getMonth(),a=new Date(e,t+1,0);for(let n=1;n<=a.getDate();n++){let $=new Date(e,t,n),i=this.get_events_by_date($);if(i.length>0){let r=document.createElement("div");r.classList.add("agenda-date-container");let d=document.createElement("h2");d.innerText=$.toDateString(),r.appendChild(d);let l=document.createElement("div");l.classList.add("agenda-date-events"),i.forEach(e=>{let t=document.createElement("button");t.classList.add("agenda-event"),t.innerText=e.title,t.style.backgroundColor=e.color,t.style.color=e.text_color,t.addEventListener("click",()=>this.open_event(e.id)),l.appendChild(t)}),r.appendChild(l),this.calendarBody.appendChild(r),this.calendarBody.innerHTML+="<hr>"}}}changeDate(e){"month"===this.view?this.currentDate.setMonth(this.currentDate.getMonth()+e):"week"===this.view?this.currentDate.setDate(this.currentDate.getDate()+7*e):"day"===this.view&&this.currentDate.setDate(this.currentDate.getDate()+e),this.render()}getStartOfWeek(e){let t=new Date(e),a=t.getDay(),n=t.getDate()-a+(0===a?-6:1);return t.setDate(n),t}renderTo(e){e.appendChild(this.container)}open_event=async function(e){let t=calendar.events.get(e),a=calendar.metadata.get(e);if(!t){console.error("Event not found!");return}a instanceof Function&&(a="AsyncFunction"===a.constructor.name?await a(e):a(e));let n=document.createElement("div");n.classList.add("event-modal"),n.setAttribute("onclick","close_event()");let $=document.createElement("div");$.classList.add("event-modal-content"),$.addEventListener("click",e=>e.stopPropagation()),$.innerHTML=`
            <div class="event-head">
                <h1>${t.title}</h1>
                <button class="event-close" onclick="close_event()"><h1>&times;</h1></button>
            </div>
            <hr>
            <h2><strong>Start:</strong></h2> <p>${new Date(1e3*t.start_timestamp).toLocaleString(void 0,{hour12:!this.config["24 hour time"]})}</p>
            <h2><strong>End:</strong></h2> <p> ${new Date(1e3*t.end_timestamp).toLocaleString(void 0,{hour12:!this.config["24 hour time"]})}</p>
            <h2><strong>Tags:</strong></h2>
            <div class="event-tags">
            ${t.tags.map(e=>`<div class="event-tag" style="color:${e.color}; border-color:${e.color}; background-color:${e.color}40;">${e.name}</div>`).join("")}
    
            </div>
            <p>${a?.description||"No description available."}</p>
            <div class="event-fields">
                ${a?.fields?.map(e=>`
                    <div class="event-field">
                        ${e.inline?`
                        <div class="event-inline">
                            <h3>${e.title}</h3>
                            <p>${e.value?e.value:""}</p>
                        </div>`:`<h3>${e.title}</h3>
                        <p>${e.value?e.value:""}</p>`}
                        ${e.custom_html?`<iframe scrolling="no" class="event-custom-html" srcdoc='${e.custom_html}' onload="ResizeEventIframe(this)" loading="lazy"></iframe>`:""}
                        
                    </div>
                `).join("")||""}
            </div>
        `,n.appendChild($),window.close_event=function(){n.remove()},document.body.appendChild(n)}}window.ResizeEventIframe=function(e){e.contentWindow.document.body&&(e.style.height=e.contentWindow.document.body.scrollHeight+"px")};